# ==============================================================================
# GuessLyfe Backend - Test Environment
# ==============================================================================
#
# This file contains configuration for running automated tests.
# Used by Jest, E2E tests, and integration tests.
#
# ==============================================================================

# ------------------------------------------------------------------------------
# Application
# ------------------------------------------------------------------------------
NODE_ENV=test
APP_VERSION=1.0.0-test
PORT=3001
API_PREFIX=api/v1
APP_NAME=guesslyfe-backend-test

# ------------------------------------------------------------------------------
# Frontend URLs (Test)
# ------------------------------------------------------------------------------
CORS_ALLOWED_ORIGINS=http://localhost:3001,http://127.0.0.1:3001
CORS_CREDENTIALS=true
FRONTEND_URL=http://localhost:3001
ADMIN_DASHBOARD_URL=http://localhost:3001/admin

# ------------------------------------------------------------------------------
# Database (Separate test database)
# ------------------------------------------------------------------------------
DB_HOST=localhost
DB_PORT=5432
DB_DATABASE=guesslyfe_test
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_POOL_MIN=1
DB_POOL_MAX=5
DB_LOGGING=false
DB_SYNCHRONIZE=true
DB_SSL_MODE=disable
LOG_QUERIES=false

# ------------------------------------------------------------------------------
# Redis (Separate test DB)
# ------------------------------------------------------------------------------
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=15
REDIS_TIMEOUT=5000
REDIS_PREFIX=guesslyfe:test:
REDIS_CACHE_TTL=60

# ------------------------------------------------------------------------------
# Bull Queue (Test)
# ------------------------------------------------------------------------------
BULL_REDIS_HOST=localhost
BULL_REDIS_PORT=6379
BULL_REDIS_DB=14
BULL_REDIS_PASSWORD=
QUEUE_NOTIFICATION_CONCURRENCY=1
QUEUE_BLOCKCHAIN_CONCURRENCY=1
QUEUE_EMAIL_CONCURRENCY=1
QUEUE_MAX_RETRY_ATTEMPTS=1
QUEUE_RETRY_BACKOFF_MS=100
QUEUE_MONITOR_ENABLED=false
QUEUE_MONITOR_PATH=/admin/queues

# ------------------------------------------------------------------------------
# JWT Authentication (Test secrets)
# ------------------------------------------------------------------------------
JWT_SECRET=test-secret-not-for-production
JWT_EXPIRATION=1h
JWT_REFRESH_SECRET=test-refresh-secret
JWT_REFRESH_EXPIRATION=7d
JWT_ISSUER=guesslyfe.test
JWT_AUDIENCE=guesslyfe-api-test

# ------------------------------------------------------------------------------
# Blockchain (Mock for tests)
# ------------------------------------------------------------------------------
BLOCKCHAIN_NETWORK=baseSepolia
BLOCKCHAIN_RPC_URL=http://localhost:8545
BLOCKCHAIN_RPC_URL_FALLBACK=
BLOCKCHAIN_CHAIN_ID=31337
BLOCKCHAIN_RPC_TIMEOUT=5000
BLOCKCHAIN_PROVIDER_PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
BLOCKCHAIN_GAS_LIMIT=500000
BLOCKCHAIN_GAS_PRICE_MULTIPLIER=1.0
BLOCKCHAIN_CONFIRMATIONS=0
BLOCKCHAIN_INDEXING_ENABLED=false
BLOCKCHAIN_INDEXING_START_BLOCK=0

# ------------------------------------------------------------------------------
# Smart Contracts (Test addresses)
# ------------------------------------------------------------------------------
CONTRACT_USDC=0x5FbDB2315678afecb367f032d93F642f64180aa3
CONTRACT_FEE_COLLECTOR=0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512
CONTRACT_CREATOR_SHARE_FACTORY=0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
CONTRACT_OPINION_MARKET=0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9
CONTRACT_OPINION_MARKET_FACTORY=
CONTRACT_OPINION_MARKET_IMPLEMENTATION=

# ------------------------------------------------------------------------------
# Twitter API (Mocked in tests)
# ------------------------------------------------------------------------------
TWITTER_CLIENT_ID=test-client-id
TWITTER_CLIENT_SECRET=test-client-secret
TWITTER_BEARER_TOKEN=test-bearer-token
TWITTER_CALLBACK_URL=http://localhost:3001/api/v1/auth/twitter/callback
TWITTER_RATE_LIMIT_BUFFER=1000

# ------------------------------------------------------------------------------
# Email (Mocked in tests)
# ------------------------------------------------------------------------------
SENDGRID_API_KEY=SG.test-api-key
SENDGRID_FROM_EMAIL=test@guesslyfe.test
SENDGRID_FROM_NAME=GuessLyfe Test
SENDGRID_TEMPLATE_WELCOME=d-test-template
SENDGRID_TEMPLATE_TRADE_CONFIRMATION=d-test-template
SENDGRID_TEMPLATE_MARKET_RESOLVED=d-test-template
SENDGRID_TEMPLATE_PASSWORD_RESET=d-test-template

# ------------------------------------------------------------------------------
# Firebase (Mocked)
# ------------------------------------------------------------------------------
FCM_SERVER_KEY=test-fcm-key
FCM_PROJECT_ID=test-project

# ------------------------------------------------------------------------------
# Error Tracking (Disabled in tests)
# ------------------------------------------------------------------------------
SENTRY_DSN=
SENTRY_ENABLED=false
SENTRY_ENVIRONMENT=test
SENTRY_RELEASE=
SENTRY_TRACES_SAMPLE_RATE=0
SENTRY_PROFILES_SAMPLE_RATE=0
SENTRY_DEBUG=false

# ------------------------------------------------------------------------------
# GCP (Not used in tests)
# ------------------------------------------------------------------------------
GCP_PROJECT_ID=test-project
GCP_REGION=us-central1
GCP_SERVICE_ACCOUNT_KEY_PATH=
GCP_STORAGE_BUCKET=test-bucket
GCP_LOGGING_ENABLED=false

# ------------------------------------------------------------------------------
# Rate Limiting (Disabled for tests)
# ------------------------------------------------------------------------------
THROTTLE_TTL=60
THROTTLE_LIMIT=10000
RATE_LIMIT_AUTH_TTL=60000
RATE_LIMIT_AUTH_LIMIT=10000
RATE_LIMIT_CREATE_MARKET_TTL=3600000
RATE_LIMIT_CREATE_MARKET_LIMIT=10000
RATE_LIMIT_TRADE_TTL=60000
RATE_LIMIT_TRADE_LIMIT=10000
RATE_LIMIT_WHITELIST_IPS=127.0.0.1,::1

# ------------------------------------------------------------------------------
# Security (Relaxed for tests)
# ------------------------------------------------------------------------------
SECURITY_HEADERS_ENABLED=false
CSP_ENABLED=false
CSP_MODE=none
CSRF_ENABLED=false
TRUSTED_PROXY_IPS=127.0.0.1,::1
ADMIN_API_KEY=test-admin-key
API_KEY_AUTH_ENABLED=false
ADMIN_USERNAME=admin
ADMIN_PASSWORD=admin

# ------------------------------------------------------------------------------
# File Upload (Mock)
# ------------------------------------------------------------------------------
MAX_FILE_SIZE=1048576
ALLOWED_FILE_TYPES=image/jpeg,image/png
UPLOAD_DESTINATION=./test-uploads
UPLOAD_PATH=./test-uploads

# ------------------------------------------------------------------------------
# Logging (Minimal for tests)
# ------------------------------------------------------------------------------
LOG_LEVEL=error
LOG_TO_CONSOLE=false
LOG_TO_FILE=false
LOG_FILE_DIR=./test-logs
LOG_FILE_MAX_SIZE=10m
LOG_FILE_MAX_FILES=1d
LOG_GCP_ENABLED=false
LOG_REQUESTS=false

# ------------------------------------------------------------------------------
# Monitoring (Disabled for tests)
# ------------------------------------------------------------------------------
METRICS_ENABLED=false
METRICS_PATH=/metrics
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_TIMEOUT=1000
PERFORMANCE_MONITORING_ENABLED=false
SLOW_REQUEST_THRESHOLD=10000
SLOW_ENDPOINT_THRESHOLD_MS=10000

# ------------------------------------------------------------------------------
# Swagger (Disabled in tests)
# ------------------------------------------------------------------------------
SWAGGER_ENABLED=false
SWAGGER_PATH=/api/docs
SWAGGER_TITLE=GuessLyfe API (Test)
SWAGGER_DESCRIPTION=Test API
SWAGGER_VERSION=1.0.0-test

# ------------------------------------------------------------------------------
# Cron Jobs (Disabled in tests)
# ------------------------------------------------------------------------------
CRON_ENABLED=false
CRON_MARKET_RESOLUTION=*/5 * * * *
CRON_NOTIFICATION_PROCESSING=* * * * *
CRON_DAILY_STATS=0 0 * * *
CRON_CLEANUP=0 2 * * 0

# ------------------------------------------------------------------------------
# Feature Flags (All enabled for testing)
# ------------------------------------------------------------------------------
FEATURE_MARKET_CREATION=true
FEATURE_TRADING=true
FEATURE_SOCIAL=true
FEATURE_NOTIFICATIONS=true
FEATURE_REFERRALS=true
BETA_FEATURES_ENABLED=true

# ------------------------------------------------------------------------------
# Development Tools
# ------------------------------------------------------------------------------
HOT_RELOAD=false
DEBUG=false
SEED_DATABASE=false
MOCK_EXTERNAL_SERVICES=true

# ------------------------------------------------------------------------------
# Performance (Fast for tests)
# ------------------------------------------------------------------------------
COMPRESSION_ENABLED=false
COMPRESSION_LEVEL=1
CACHE_ENABLED=false
CACHE_TTL=10
QUERY_CACHE_ENABLED=false
QUERY_CACHE_TTL=10

# ------------------------------------------------------------------------------
# Alerts (Disabled in tests)
# ------------------------------------------------------------------------------
SLACK_WEBHOOK_URL=
SLACK_ALERT_CHANNEL=#test
DISCORD_WEBHOOK_URL=
ALERT_WEBHOOK_URL=

# ------------------------------------------------------------------------------
# Maintenance
# ------------------------------------------------------------------------------
MAINTENANCE_MODE=false
MAINTENANCE_MESSAGE=
MAINTENANCE_ALLOWED_IPS=127.0.0.1

# ------------------------------------------------------------------------------
# Localization
# ------------------------------------------------------------------------------
DEFAULT_LOCALE=en
SUPPORTED_LOCALES=en
TIMEZONE=UTC

# ------------------------------------------------------------------------------
# Business Logic (Relaxed for tests)
# ------------------------------------------------------------------------------
MIN_MARKET_DURATION_HOURS=0
MAX_MARKET_DURATION_DAYS=1000
PLATFORM_FEE_PERCENTAGE=2.5
MIN_TRADE_AMOUNT=1
MAX_TRADE_AMOUNT=999999999999999999999999
MARKET_VERIFICATION_ENABLED=false
CREATOR_REPUTATION_THRESHOLD=0

# ------------------------------------------------------------------------------
# Testing
# ------------------------------------------------------------------------------
TEST_DB_DATABASE=guesslyfe_test
TEST_MODE=true

# ------------------------------------------------------------------------------
# Compliance
# ------------------------------------------------------------------------------
GDPR_ENABLED=false
DATA_RETENTION_DAYS=1
USER_DATA_EXPORT_ENABLED=false
COOKIE_CONSENT_ENABLED=false
